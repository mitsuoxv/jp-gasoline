---
title: "Gasoline prices in Japan"
author: "Mitsuo Shiota"
date: "2021-11-17"
output: 
  github_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(readxl)
library(tsibble)
library(fable)
```

Updated: `r Sys.Date()`

## Motivation

[Nikkei reported](https://www.nikkei.com/article/DGXZQOUA169350W1A111C2000000/) on November 17, 2021 that Ministry of Economy, Trade and Industry (METI) is considering a subsidy to gasoline wholesalers to suppress gasoline retail prices when they rise to higher than 170 yen per litre. At the end of the article, Nikkei showed a skeptical view saying, "As the number of retailers has decreased, the retailers may not reduce retail prices even if wholesale prices fall." So I would like to study the relationship between retail and wholesale prices of gasoline in Japan.

## Get gasoline prices

Agency for National Resources Energy under METI publishes gasoline prices in its [web site](https://www.enecho.meti.go.jp/statistics/petroleum_and_lpgas/pl007/results.html#headline1). Although the original retail price data include consumption tax since April 1, 2004, I exclude consumption tax all over the period.

```{r get_data, echo=FALSE, message=FALSE}

wholesale <- read_excel("data/211029o5.xls",
                        sheet = "レギュラー",
                        col_types = c("text", "date", rep("text", 55))
                        ) %>% 
  select(date = "調査年月", price = "全         国") %>% 
  mutate(
    date = as.Date(date),
    price = as.numeric(price)
    ) 

wholesale_price <- wholesale %>% 
  mutate(month = yearmonth(date)) %>% 
  select(month, wholesale_price = price) %>% 
  as_tsibble(index = month)

retail <- read_excel("data/211117s5.xls", 
                     sheet = "レギュラー",
                        col_types = c("text", "date", rep("text", 59)))

retail <- retail %>% 
  slice_head(n = nrow(retail) - 1) %>% 
  select(date = "調査日", price = "全         国") %>% 
  mutate(
    date = as.Date(date),
    price = as.numeric(price)
    ) 

retail_price <- retail %>% 
  mutate(
    tax_rate = case_when(
      date < "2004-04-01" ~ 0,
      date < "2014-04-01" ~ .05,
      date < "2019-10-01" ~ .08,
      TRUE ~ .1
                       ),
    price_excl_tax = price / (1 + tax_rate)
  )

retail_price_month <- retail_price %>% 
  select(date, retail_price = price_excl_tax) %>% 
  as_tsibble(index = date) %>% 
  index_by(month = yearmonth(date)) %>% 
  summarize(retail_price = mean(retail_price))

combo <- retail_price_month %>% 
  filter_index("2000 Jul" ~ .) %>% 
  left_join(wholesale_price, by = "month") %>% 
  mutate(difference = retail_price - wholesale_price) %>% 
  pivot_longer(retail_price:difference) %>% 
  update_tsibble(key = name)

```

## Plot retail and wholesale prices

Yes, both retail and wholesale prices are rising.

```{r plot1, echo=FALSE, warning=FALSE}

combo %>% 
  filter(name != "difference") %>% 
  autoplot(value) +
  expand_limits(y = 0) +
  labs(y = "Yen per litre", title = "Gasoline prices in Japan") +
  guides(colour = guide_legend(title = NULL))

```

## Plot price differences

Differences between retail and wholesale prices have been increasing since 2016. The mean difference was `r combo %>% filter(name == "difference") %>% filter_index("2000 Jul" ~ "2015 Dec") %>% pull(value) %>% mean() %>% round()` yen per litre from 2000 Jul to 2015 Dec, and is `r combo %>% filter(name == "difference", !is.na(value)) %>% slice_tail(n = 1) %>% pull(value) %>% round()` in `r combo %>% filter(name == "difference", !is.na(value)) %>% slice_tail(n = 1) %>% pull(month)`. This may reflect the reduced competition among retailers. You can see the number of retailers has constantly decreased since around 1995 in the last page of [this material (Japanese)](https://www.enecho.meti.go.jp/category/resources_and_fuel/distribution/hinnkakuhou/data/2021_07_30_01.pdf) from Agency for National Resources Energy.

```{r plot 2, echo=FALSE, warning=FALSE}

combo %>% 
  filter(name == "difference") %>% 
  autoplot(value) +
  expand_limits(y = 0) +
  labs(y = "Yen per litre",
       title = "Differences between retail and wholesale prices")

```

EOL
